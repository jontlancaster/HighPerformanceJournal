<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Clearlink Journal</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous"/>
</head>
<style>
    .button {
        color: #fff;
        background-color: #337ab7;
        border-color: #2e6da4;
    }
</style>
<body ng-app="highPerformanceJournal">
<div class="container-fluid" ng-controller="AdminController">
    <div class="row">
        <ul class="nav nav-pills">
            <li disabled="disabled">Clearlink</li>
            <li role="presentation"><a href="/home">Home</a></li>
            <li role="presentation"><a href="/journal">Reports</a></li>
            <li role="presentation" class="active"><a href="/admin">Admin</a></li>
            <li role="presentation"><a href="/logout">Logout</a></li>
        </ul>
    </div>
    <div class="row">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
            <div>
                <label for="firstNameInput">First Name</label>
                <input ng-model="firstName" id="firstNameInput" style="display:block"
                       maxlength="40"/>
            </div>
            <div>
                <label for="lastNameInput">Last Name</label>
                <input ng-model="lastName" id="lastNameInput" style="display:block;"
                       maxlength="40"/>
            </div>
            <div>
                <label for="userNameInput">Email <i>This will used as the username</i></label>
                <input ng-model="username" id="userNameInput" style="display:block;"
                       maxlength="40"/>
            </div>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
            <div>
                <label for="newPasswordInput">New Password</label>
                <input ng-model="newPassword" id="newPasswordInput" type="password"
                       style="display:block" maxlength="40"/>
            </div>
            <div>
                <label for="newPasswordConfirmInput">Confirm Password</label>
                <input ng-model="newPasswordConfirm" id="newPasswordConfirmInput"
                       type="password" style="display:block;" maxlength="40"/>
            </div>
        </div>
        <div class="row" ng-show="loggedInUserIsAnAdmin">
            <h4>Admin Actions</h4>
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
                    <label for="coachRadioButton">Coach</label><br/>
                    <input ng-model="coachCheckboxIsChecked" id="coachRadioButton" type="checkbox" value="Coach"/>
                </div>
                <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
                    <label for="adminRadioButton">Admin</label><br/>
                    <input ng-model="adminCheckboxIsChecked" ng-disabled="!coachCheckboxIsChecked" id="adminRadioButton"
                           type="checkbox" value="Admin"/>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
                <button class="btn button" ng-click="saveUser()">Save</button>
            </div>
        </div>
    </div>
    <div class="row" ng-show="loggedInUserIsAnAdmin">
        <h4>Admin Actions</h4>
        <div>
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                <label for="userNameSearchInput">Search User</label>
                <input ng-model="usernameForSearch" id="userNameSearchInput" style="display:block;"
                       maxlength="60"/>
                <button ng-disabled="usernameForSearchIsInvalid()" class="btn button" ng-click="searchForUser()"
                        style="margin-top:10px;">Search
                </button>
            </div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.2/angular.min.js"></script>
<script>
    var myApp = angular.module('highPerformanceJournal', []);

    myApp.controller('AdminController', ['$scope', '$http',
        function ($scope, $http) {
            $scope.loggedInUserIsAnAdmin = true;

            function saveUserRoles() {
                $http.post('/userRoles/saveUserRoles', {
                    userIsAnAdmin: !!$scope.adminCheckboxIsChecked,
                    userIsACoach: !!$scope.coachCheckboxIsChecked,
                    username: $scope.username
                }).then(function (result) {
                    console.log('saveUser result: ', result.data);//todo display success/failed to save message
                });
            }

            function saveUser() {
                $http.post('/users/saveUser', {
                    firstName: $scope.firstName,
                    lastName: $scope.lastName,
                    enabled: true,
                    password: $scope.newPasswordConfirm,
                    username: $scope.username
                }).then(function (result) {
                    console.log('saveUser result: ', result.data);//todo display success/failed to save message
                });
            }

            $scope.saveUser = function () {
                console.log('newPassword: ' + $scope.newPassword);
                console.log('newPasswordConfirm: ' + $scope.newPasswordConfirm);
                console.log('firstName: ' + $scope.firstName);
                console.log('lastName: ' + $scope.lastName);
                console.log('username: ' + $scope.username);
                console.log('isCoach: ' + !!$scope.coachCheckboxIsChecked);
                console.log('isAdmin: ' + !!$scope.adminCheckboxIsChecked);

                saveUser();

                if ($scope.loggedInUserIsAnAdmin === true) {
                    saveUserRoles();
                }
            };

            $scope.usernameForSearchIsInvalid = function () {
                return !$scope.usernameForSearch || $scope.usernameForSearch.trim().length === 0;
            };

            $scope.searchForUser = function () {
                if ($scope.usernameForSearchIsInvalid()) {
                    console.log('username is invalid: ' + $scope.usernameForSearch);
                    return;
                }
                $http.get('/users/find', {params: {username: $scope.usernameForSearch.trim()}}).then(function (result) {
                    var user = result.data;
                    console.log('searchForUser result: ', user);
                    $scope.firstName = user.firstName;
                    $scope.lastName = user.lastName;
                    $scope.username = user.username;
                });
            };
        }]);
</script>
</body>
</html>